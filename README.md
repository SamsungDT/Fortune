# AI ì¢…í•© ìš´ì„¸ ì„œë¹„ìŠ¤

## 0. ì‚¬ìš©í•´ë³´ê¸°

* [AI ì¢…í•© ìš´ì„¸ ì„œë¹„ìŠ¤](https://fortuneki.site)

---

## 1. í”„ë¡œê·¸ë¨ ì†Œê°œ

* AI ê¸°ë°˜ ì¬ë¯¸ìš© ì„œë¹„ìŠ¤

  * ê´€ìƒ
  * ì˜¤ëŠ˜ì˜ ìš´ì„¸
  * í‰ìƒ ìš´ì„¸
  * í•´ëª½

---

## 2. ì£¼ìš” ê¸°ëŠ¥

* **ìš´ì„¸ ë¶„ì„**: ê´€ìƒ, ì˜¤ëŠ˜ì˜ ìš´ì„¸, í‰ìƒ ìš´ì„¸, í•´ëª½ ì œê³µ
* **íšŒì› ì‹œìŠ¤í…œ**: Spring Security + JWT ê¸°ë°˜ ì¸ì¦

  * ë¡œê·¸ì¸ ì‹œ MySQL ì¡°íšŒ â†’ JWT ë°œê¸‰
* **íŒŒì¼ ì—…ë¡œë“œ**: AWS S3 Presigned URL ì‚¬ìš© â†’ ì„œë²„ ë¶€í•˜ ê°ì†Œ
* **ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§**: Prometheus + Grafana
* **ì‹¤ì‹œê°„ ì•Œë¦¼**: ì„œë²„ ì˜¤ë¥˜ ë°œìƒ ì‹œ Discord ì•Œë¦¼

## 3. íŒ€ êµ¬ì„±ì›

| ê³ ë™ìˆ˜ | ê¹€ë‚˜ì—° | ê¹€ì§€ì˜ˆ | ë°•ì„ ë¯¼ | ë°•ì¬ê·œ |
|:----:|:----:|:----:|:----:|:----:|
|[<img src="https://github.com/kdongsu5509.png" width="100px">](https://github.com/kdongsu5509) | [<img src="https://github.com/kimnaiyeon.png" width="100px">](https://github.com/kimnaiyeon) |[<img src="https://github.com/6715sunmin.png" width="100px">](https://github.com/6715sunmin)  | [<img src="https://github.com/Mariajiye.png" width="100px">](https://github.com/Mariajiye) | [<img src="https://github.com/bb0479.png" width="100px">](https://github.com/bb0479) |
| ë°±ì—”ë“œ | í”„ë¡ íŠ¸ì—”ë“œ | í”„ë¡ íŠ¸ì—”ë“œ | í”„ë¡ íŠ¸ì—”ë“œ, PM | | í”„ë¡ íŠ¸ì—”ë“œ |


## 4. ê¸°ìˆ  ìŠ¤íƒ ë° ê°œë°œ í™˜ê²½

### ë””ìì¸

<img src="https://img.shields.io/badge/figma-%23F24E1E.svg?style=for-the-badge&logo=figma&logoColor=white">

### ë°±ì—”ë“œ

<div>
  <img src= "https://img.shields.io/badge/Java-ED8B00?style=for-the-badge&logo=openjdk&logoColor=white">
  <img src= "https://img.shields.io/badge/Spring-6DB33F?style=for-the-badge&logo=spring&logoColor=whiteh">
  <img src="https://img.shields.io/badge/Spring Data JPA-6DB33F?style=for-the-badge&logo=SpringDataJPA&logoColor=white">
  <img src="https://img.shields.io/badge/Spring Data Redis-6DB33F?style=for-the-badge&logo=SpringDataRedis&logoColor=white">
  <img src="https://img.shields.io/badge/QueryDSL-6DB33F?style=for-the-badge&logo=QueryDSL&logoColor=white">
  <img src="https://img.shields.io/badge/Spring AI-6DB33F?style=for-the-badge&logo=SpringAI&logoColor=white">
  <img src="https://img.shields.io/badge/Spring Security-6DB33F?style=for-the-badge&logo=SpringSecurity&logoColor=white">
</div>
<div>
  <img src= "https://img.shields.io/badge/redis-%23DD0031.svg?&style=for-the-badge&logo=redis&logoColor=white">
  <img src="https://img.shields.io/badge/MySQL-00000F?style=for-the-badge&logo=mysql&logoColor=white">
  <img src="https://img.shields.io/badge/IntelliJ_IDEA-000000.svg?style=for-the-badge&logo=intellij-idea&logoColor=white">
</div>

### í”„ë¡ íŠ¸ì—”ë“œ
<div>
  <img src= "https://img.shields.io/badge/TypeScript-007ACC?style=for-the-badge&logo=typescript&logoColor=white">
  <img src= "https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB">
  <img src= "https://img.shields.io/badge/Visual_Studio_Code-0078D4?style=for-the-badge&logo=visual%20studio%20code&logoColor=white">
</div>

### ëª¨ë‹ˆí„°ë§

<div>
  <img src="https://img.shields.io/badge/Prometheus-E6522C?style=for-the-badge&logo=Prometheus&logoColor=white">
  <img src="https://img.shields.io/badge/grafana-%23F46800.svg?style=for-the-badge&logo=grafana&logoColor=white">
  <img src="https://img.shields.io/badge/Discord-7289DA?style=for-the-badge&logo=discord&logoColor=white">
</div>

### ì¸í”„ë¼

<div>
  <img src="https://img.shields.io/badge/Nginx-009639?style=for-the-badge&logo=Nginx&logoColor=white">
  <img src="https://img.shields.io/badge/Amazon_AWS-232F3E?style=for-the-badge&logo=amazon-aws&logoColor=white">
  <img src="https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white">
</div>

### í˜‘ì—… ë„êµ¬
<div>
  <img src="https://img.shields.io/badge/Git-F05032.svg?&style=for-the-badge&logo=Git&logoColor=white">
  <img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
  <img src="https://img.shields.io/badge/Notion-%23000000.svg?style=for-the-badge&logo=notion&logoColor=white">
</div>
<br>

### ë°°í¬ ë° ìš´ì˜ í™˜ê²½

- **AI í†µí•©**: Spring AI Framework, Structured Output  
- **ë³´ì•ˆ/ì¸ì¦**: Spring Security, JWT ê¸°ë°˜ ì¸ì¦  
- **DB**: Redis, MYSQL, Spring Data JPA, QueryDSL, Amazon ECR
- **ë°°í¬ í™˜ê²½**: Docker Â· GitHub Actions Â· AWS EC2 Â· Amazon ECR

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
Fortune/
â”œâ”€â”€ .github/
â”‚     â””â”€â”€ ISSUE_TEMPLATE/           # ì´ìŠˆ í…œí”Œë¦¿
â”‚     â””â”€â”€ workflows/                # CI/CD
â”‚     â””â”€â”€ PULL_REQUEST_TEMPLATE.md  # PR í…œí”Œë¦¿
â”œâ”€â”€ AdminPage/                      # ê´€ë¦¬ì í˜ì´ì§€
â”œâ”€â”€ Backend/                        # ë°±ì—”ë“œ ì½”ë“œ
â”œâ”€â”€ Frontend/                       # í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## ë°±ì—”ë“œ í•µì‹¬

* **ì „ëµ íŒ¨í„´ ì ìš©**: ì½”ë“œ ì¤‘ë³µ ì œê±°

  * `FortuneStrategy` ì¸í„°í˜ì´ìŠ¤: `execute()`, `getRedisType()`
  * `AbstractFortuneStrategy`: ê³µí†µ ë¡œì§ êµ¬í˜„
  * êµ¬ì²´ ì „ëµ í´ë˜ìŠ¤: `DailyFortuneStrategy`, `FaceStrategy` ë“±
  * `FortuneContext`: ìš”ì²­ì— ë§ëŠ” ì „ëµ ì‹¤í–‰
* **ì„±ëŠ¥ ìµœì í™”**

  * Redis ì‚¬ìš©
  * Refresh token ì €ì¥
  * ì„œë¹„ìŠ¤ í†µê³„ ê´€ë¦¬

---

## 5. ERD
<img width="1304" height="800" alt="image" src="https://github.com/user-attachments/assets/d88dfb65-9e15-4d7c-860c-08808a0e6c4e" />

## 6. ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì„±
<img width="1219" height="528" alt="image" src="https://github.com/user-attachments/assets/23a81707-1d52-4802-89ef-59549ef84566" />

---

## 7. CI/CD

* **CI**

  * GitHub Actions
  * main ë¸Œëœì¹˜ í‘¸ì‹œ ì‹œ ìë™ ë¹Œë“œ & í…ŒìŠ¤íŠ¸
  * Docker ì´ë¯¸ì§€ ë¹Œë“œ â†’ ECR í‘¸ì‹œ
* **CD**

  * EC2 SSH ì ‘ì† â†’ ìµœì‹  ì´ë¯¸ì§€ pull
  * `docker-compose up -d` ìë™ ì‹¤í–‰
  * Prometheus ì„¤ì • ìë™ ë°˜ì˜
  * ì´ì „ ì´ë¯¸ì§€ ìë™ ì •ë¦¬

```yaml
# .github/workflows/ci-cd.yml

name: Spring CI-CD with AWS

on:
    workflow_dispatch:
    push:
        branches: ["main"]
        paths:
            - "Backend/**"
env:
    AWS_REGION: ap-northeast-2
    ECR_REPOSITORY: fortune-ar
    CONTAINER_NAME: spring-server-container
    PROJECT_PATH: ./Backend

jobs:
    # -------------------- CI (Build & Push to ECR) --------------------
    ci:
        name: Continuous Integration
        runs-on: ubuntu-latest

        outputs:
            image_uri: ${{ steps.build-image.outputs.image }}

        services:
            redis:
                image: redis:7-alpine
                ports:
                    - 6379:6379
                options: >-
                    --network-alias redis

        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Set up JDK 21
              uses: actions/setup-java@v4
              with:
                  java-version: "21"
                  distribution: "temurin"

            - name: Grant execute permission for gradlew
              run: chmod +x ${{ env.PROJECT_PATH }}/gradlew

            - name: Add application-secret.yaml
              env:
                  SPRING_SECRET_YAML: ${{ secrets.SPRING_SECRET_YAML }}
              run: |
                  echo "$SPRING_SECRET_YAML" > ${{ env.PROJECT_PATH }}/src/main/resources/application-secret.yaml

            - name: Build with Gradle (do tests internally)
              run: ./gradlew clean build
              working-directory: ${{ env.PROJECT_PATH }}

            - name: Configure AWS credentials
              uses: aws-actions/configure-aws-credentials@v4
              with:
                  aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
                  aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
                  aws-region: ${{ env.AWS_REGION }}

            - name: Login to Amazon ECR
              id: login-ecr
              uses: aws-actions/amazon-ecr-login@v2

            - name: Build, tag, and push image to Amazon ECR
              id: build-image
              env:
                  ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
                  IMAGE_TAG: ${{ github.sha }}
              run: |
                  set -euo pipefail
                  docker build -t "$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG" -f ${{ env.PROJECT_PATH }}/Dockerfile ${{ env.PROJECT_PATH }}
                  docker push "$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG"
                  echo "image=$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG" >> "$GITHUB_OUTPUT"

    # -------------------- CD (Deploy on EC2) --------------------
    cd:
        name: Continuous Deployment
        needs: ci
        runs-on: ubuntu-latest

        steps:
            - name: Get GitHub Action VM IP
              id: ip
              uses: haythem/public-ip@v1.3
            - name: Configure AWS credentials
              uses: aws-actions/configure-aws-credentials@v4
              with:
                  aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
                  aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
                  aws-region: ${{ env.AWS_REGION }}
            - name: Add GitHub Action VM IP to EC2 security group (SSH)
              run: |
                  aws ec2 authorize-security-group-ingress \
                      --group-id ${{ secrets.EC2_SECURITY_GROUP_ID }} \
                      --protocol tcp \
                      --port 22 \
                      --cidr ${{ steps.ip.outputs.ipv4 }}/32
            - name: Deploy to EC2 via SSH
              uses: appleboy/ssh-action@v1.0.3
              with:
                  host: ${{ secrets.EC2_HOST }}
                  username: ${{ secrets.EC2_USERNAME }}
                  key: ${{ secrets.EC2_SSH_KEY }}
                  script: |
                      set -euo pipefail
                      IMAGE_URI='${{ needs.ci.outputs.image_uri }}'
                      if [ -z "$IMAGE_URI" ]; then
                          echo "ERROR: IMAGE_URI is empty. Check CI job outputs." >&2
                          exit 1
                      fi
                      ECR_REGISTRY_URL="$(echo "$IMAGE_URI" | cut -d/ -f1)"

                      echo "Downloading docker-compose.yml..."
                      # GitHub ë ˆí¬ì§€í† ë¦¬ì—ì„œ ë„ì»¤ ì»´í¬ì¦ˆ íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ê²½ë¡œ ìˆ˜ì •)
                      wget -O docker-compose.yml https://raw.githubusercontent.com/SamsungDT/Fortune/main/Backend/docker-compose.yml

                      # Prometheus ì„¤ì • íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ì¶”ê°€)
                      echo "Downloading prometheus.yml..."
                      wget -O prometheus.yml https://raw.githubusercontent.com/SamsungDT/Fortune/main/Backend/prometheus.yml

                      echo "Logging in to ECR..."
                      aws ecr get-login-password --region '${{ env.AWS_REGION }}' \
                          | docker login --username AWS --password-stdin "$ECR_REGISTRY_URL"

                      echo "Pulling the latest image..."
                      docker pull "$IMAGE_URI"

                      # ë„ì»¤ ì»´í¬ì¦ˆ íŒŒì¼ì˜ fortune-ar ì´ë¯¸ì§€ íƒœê·¸ë¥¼ ìµœì‹  ì´ë¯¸ì§€ë¡œ ë³€ê²½
                      echo "Updating docker-compose.yml with new image tag..."
                      sed -i "s|fortune-ar:latest|$IMAGE_URI|g" docker-compose.yml

                      echo "Running docker-compose up..."
                      docker compose -f docker-compose.yml up -d

                      # ì´ì „ ì´ë¯¸ì§€ ì‚­ì œ (ì„ íƒ ì‚¬í•­)
                      echo "Cleaning up old images..."
                      docker image prune -f
            - name: Remove GitHub Action VM IP from EC2 security group
              if: always()
              run: |
                  aws ec2 revoke-security-group-ingress \
                      --group-id ${{ secrets.EC2_SECURITY_GROUP_ID }} \
                      --protocol tcp \
                      --port 22 \
                      --cidr ${{ steps.ip.outputs.ipv4 }}/32
```
